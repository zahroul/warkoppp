<!DOCTYPE html>
<html lang="id">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Warkoppp - Warung Kopi Enak di Sekitarmu</title>
    </head>

    <body>
        <h1>Warkoppp</h1>

        <p>Warung Kopi Enak di Sekitarmu</p>

        <label>Cari Lokasi <input type="search" placeholder="Cari Lokasi ..."></label>

        <ul>
            <li hidden>
                <h2></h2>
                <div class="coffee-taste">Rasa Kopinya: <span></span></div>
                <div class="price">Harga: <span></span></div>
                <div class="location">Lokasi: <span></span></div>
            </li>
        </ul>

        <script>
            const app = {
                cafeCardsContainer: document.querySelector('ul'),
                cafeCardTemplate: document.querySelector('li'),

                getCafe: function() {
                    return new Promise(function(resolve) {
                        const request = new XMLHttpRequest();

                        request.onreadystatechange = function() {
                            if (request.readyState === XMLHttpRequest.DONE) {
                                if (request.status === 200) {
                                    resolve(request.response);
                                }
                            }
                        };

                        request.open('GET', 'cafe-data.json');
                        request.send();
                    });
                },

                searchCafe: function(cafeList, keyword) {
                    const foundCafeList = [];

                    cafeList.forEach(function(cafe) {
                        let keywordIndex = 0;

                        for (let i = 0; i < cafe.location.length; i++) {
                            if (keywordIndex < keyword.length) {
                                if (cafe.location[i].toLowerCase() === keyword[keywordIndex]) {
                                    keywordIndex += 1;
                                }

                                if (keyword[keywordIndex] === undefined) break;
                            }
                        }

                        if (keywordIndex !== keyword.length) return '';

                        foundCafeList.push(cafe);
                    });

                    this.createCafeList(foundCafeList);
                },

                addCafeCard: function(cafe) {
                    const card = this.cafeCardTemplate.cloneNode(true);

                    card.querySelector('h2').textContent = cafe.name;
                    card.querySelector('.coffee-taste span').textContent = cafe.coffeTaste;
                    card.querySelector('.price span').textContent = cafe.price;
                    card.querySelector('.location span').textContent = cafe.location;
                    card.removeAttribute('hidden');

                    this.cafeCardsContainer.appendChild(card);
                },

                createCafeList: function(cafeList) {
                    cafeList.forEach(function(cafe) {
                        app.addCafeCard(cafe);
                    });
                }
            };

            document.querySelector('input').addEventListener('change', function(event) {
                const keyword = event.target.value.trim();

                if (keyword === '') return '';

                app.getCafe().then(JSON.parse).then(function(response) {
                    app.searchCafe(response.cafeList, keyword);
                });
            });
        </script>
    </body>
</html>
